2025-09-17 15:52:44,680 - analist_agent - INFO - main.py:25 - Uygulama başlıyor…
2025-09-17 15:52:45,052 - numexpr.utils - INFO - utils.py:164 - NumExpr defaulting to 16 threads.
2025-09-17 15:52:47,396 - sentence_transformers.SentenceTransformer - INFO - SentenceTransformer.py:219 - Use pytorch device_name: cpu
2025-09-17 15:52:47,396 - sentence_transformers.SentenceTransformer - INFO - SentenceTransformer.py:227 - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-09-17 15:52:49,925 - graph - INFO - graph.py:196 - RAG initialize edildi (şema beslemesi yapıldı).
2025-09-17 15:52:49,925 - graph - INFO - graph.py:206 - SchemaIntel yüklendi.
2025-09-17 15:52:49,925 - graph - INFO - graph.py:212 - SQL Validator başlatıldı.
2025-09-17 15:52:49,925 - graph - INFO - graph.py:219 - repair_sql initialized.
2025-09-17 15:52:49,925 - graph - INFO - graph.py:226 - safe_sql initialized.
2025-09-18 09:48:19,208 - analist_agent - INFO - main.py:25 - Uygulama başlıyor…
2025-09-18 09:48:20,005 - numexpr.utils - INFO - utils.py:164 - NumExpr defaulting to 16 threads.
2025-09-18 09:48:24,987 - sentence_transformers.SentenceTransformer - INFO - SentenceTransformer.py:219 - Use pytorch device_name: cuda:0
2025-09-18 09:48:24,987 - sentence_transformers.SentenceTransformer - INFO - SentenceTransformer.py:227 - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-09-18 09:48:28,107 - graph - INFO - graph.py:259 - RAG initialize edildi (şema beslemesi yapıldı).
2025-09-18 09:48:28,109 - graph - INFO - graph.py:269 - SchemaIntel yüklendi.
2025-09-18 09:48:28,109 - graph - INFO - graph.py:275 - SQL Validator başlatıldı.
2025-09-18 09:48:28,109 - graph - INFO - graph.py:284 - planner initialized.
2025-09-18 09:48:28,109 - graph - INFO - graph.py:291 - paginator initialized.
2025-09-18 09:48:28,112 - graph - INFO - graph.py:298 - query cache initialized.
2025-09-18 09:48:28,112 - graph - INFO - graph.py:306 - repair_sql initialized.
2025-09-18 09:48:28,112 - graph - INFO - graph.py:313 - safe_sql initialized.
2025-09-18 09:48:57,871 - analist_agent - ERROR - main.py:54 - Çalışma sırasında hata: Invalid argument provided to Gemini: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
Traceback (most recent call last):
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langchain_google_genai/chat_models.py", line 208, in _chat_with_retry
    return generation_method(**kwargs)
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 869, in generate_content
    response = rpc(
        request,
    ...<2 lines>...
        metadata=metadata,
    )
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
        target,
    ...<3 lines>...
        on_error=on_error,
    )
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
        exc,
    ...<6 lines>...
        timeout,
    )
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/google/api_core/grpc_helpers.py", line 78, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.InvalidArgument: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/nagme/Desktop/tool-calling agent/main.py", line 46, in main
    for event in graph_app.stream(initial_state, config={"recursion_limit": 25}):
                 ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langgraph/pregel/main.py", line 2647, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langgraph/pregel/_runner.py", line 162, in tick
    run_with_retry(
    ~~~~~~~~~~~~~~^
        t,
        ^^
    ...<10 lines>...
        },
        ^^
    )
    ^
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langgraph/pregel/_retry.py", line 42, in run_with_retry
    return task.proc.invoke(task.input, config)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langgraph/_internal/_runnable.py", line 657, in invoke
    input = context.run(step.invoke, input, config, **kwargs)
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langgraph/_internal/_runnable.py", line 401, in invoke
    ret = self.func(*args, **kwargs)
  File "/home/nagme/Desktop/tool-calling agent/graph.py", line 348, in agent_node
    resp = agent_llm.invoke(msgs)
  File "/home/nagme/Desktop/tool-calling agent/utils/llm.py", line 118, in invoke
    raise last_err if last_err else RuntimeError("All providers failed with unknown error.")
  File "/home/nagme/Desktop/tool-calling agent/utils/llm.py", line 100, in invoke
    resp = model.invoke(messages, **kwargs)
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 5495, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langchain_google_genai/chat_models.py", line 1676, in invoke
    return super().invoke(input, config, stop=stop, **kwargs)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 393, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1019, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 837, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1085, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langchain_google_genai/chat_models.py", line 1790, in _generate
    response: GenerateContentResponse = _chat_with_retry(
                                        ~~~~~~~~~~~~~~~~^
        request=request,
        ^^^^^^^^^^^^^^^^
    ...<2 lines>...
        metadata=self.default_metadata,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langchain_google_genai/chat_models.py", line 238, in _chat_with_retry
    return _chat_with_retry(**params)
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/tenacity/__init__.py", line 338, in wrapped_f
    return copy(f, *args, **kw)
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/tenacity/__init__.py", line 477, in __call__
    do = self.iter(retry_state=retry_state)
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/tenacity/__init__.py", line 378, in iter
    result = action(retry_state)
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/tenacity/__init__.py", line 400, in <lambda>
    self._add_action_func(lambda rs: rs.outcome.result())
                                     ~~~~~~~~~~~~~~~~~^^
  File "/home/nagme/miniconda3/lib/python3.13/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ~~~~~~~~~~~~~~~~~^^
  File "/home/nagme/miniconda3/lib/python3.13/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/tenacity/__init__.py", line 480, in __call__
    result = fn(*args, **kwargs)
  File "/home/nagme/miniconda3/lib/python3.13/site-packages/langchain_google_genai/chat_models.py", line 220, in _chat_with_retry
    raise ChatGoogleGenerativeAIError(msg) from e
langchain_google_genai.chat_models.ChatGoogleGenerativeAIError: Invalid argument provided to Gemini: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
During task with name 'agent' and id '4fefc81c-7eb5-ae33-deb1-57d3b596697e'
